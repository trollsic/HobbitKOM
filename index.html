<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Hobbit: Kingdoms of middle Earth - Hero Experience Calculator" />

    <script src="http://code.jquery.com/jquery.min.js"></script>
    <link href="http://getbootstrap.com/dist/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <script src="http://getbootstrap.com/dist/js/bootstrap.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.2.1/knockout-min.js"></script>
    <meta charset=utf-8 />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hobbit: Kingdoms of middle Earth - Hero Experience Calculator</title>


    
  </head>

  <body>

    <div id="heroCalc" class="container">
    <div class="row">
      <div class="col-xs-6">
    Hero Level:<br/>
    <input type="text" id="heroLevel" data-bind="value:heroLevel" /><br/>
    Hero Exp:<br/>
    <input type="text" id="heroExp" data-bind="value:heroExp" /><br/>
    </div>
      <div class="col-xs-6">
    Target Hero Level:<br/>
    <input type="text" id="heroLevel" data-bind="value:targetHeroLevel" /><br/>    
        Current Exp:<span data-bind="text:currentExp()"></span><br/>
        Calculated Exp:<span data-bind="text:calculatedExp()"></span><br/>
        Needed Exp:<span data-bind="text:missingExp()"></span>
    </div>
      </div>
    <div class="row">
      Gandalfs:<span data-bind="text:gandalfs"></span>
      <input type="button" class="btn btn-success" value="+" data-bind="click:addGandalf" />
      <input type="button" class="btn btn-warning" value="-" data-bind="click:removeGandalf" />
    </div><br/>
    <div class="row">
      Archers:<span data-bind="text:archers"></span>
      <input type="button" value="+" class="btn btn-success" data-bind="click:addArchers" />
      <input type="button" value="-" class="btn btn-warning" data-bind="click:removeArchers" />
    </div><br/>
    <div class="row">
      Warriors:<span data-bind="text:warriors"></span>
      <input type="button" value="+" class="btn btn-success" data-bind="click:addWarriors" />
      <input type="button" value="-" class="btn btn-warning" data-bind="click:removeWarriors" /><br/>
    </div><br/>
    <div class="row">
      Attacks:<span data-bind="text:attacks"></span>
      <input type="button" value="+" class="btn btn-success" data-bind="click:addAttacks" />
      <input type="button" value="-" class="btn btn-warning" data-bind="click:removeAttacks" /><br/>
    </div><br/>
    <input type="button" class="btn btn-info" value="Calculate" data-bind="click:calculateTrainings"/>
    <input type="button" class="btn btn-info" value="Reset" data-bind="click:resetValues"/>
  </div>
<script>
var HeroCalcualtor = function()
{ 
  var self = this;
  self.heroLevel = ko.observable(100);
  self.heroExp=ko.observable(0);
  self.targetHeroLevel=ko.observable(212);
  self.gandalfs=ko.observable(0);
  self.archers=ko.observable(0);
  self.warriors=ko.observable(0);
  self.attacks=ko.observable(0);
    self.addGandalf=function()
    {
      self.gandalfs(self.gandalfs()+1);
    };
    self.removeGandalf=function()
    {
      self.gandalfs(self.gandalfs()-1);
    };
    self.addArchers=function()
    {
      self.archers(self.archers()+1);
    };
    self.removeArchers=function()
    {
      self.archers(self.archers()-1);
    };
    self.addWarriors=function()
    {
      self.warriors(self.warriors()+1);
    };
    self.removeWarriors=function()
    {
      self.warriors(self.warriors()-1);
    };
    self.addAttacks=function()
    {
      self.attacks(self.attacks()+1);
    };
    self.removeAttacks=function()
    {
      self.attacks(self.attacks()-1);
    };
    self.currentExp=ko.computed(function(){      
      return getExpForLevel(self.heroLevel())+(+self.heroExp());
    });
    self.calculatedExp=ko.computed(function(){      
      var stExp = +self.currentExp();
      var runesExp = (+self.gandalfs()*50000)+
        (+self.archers()*10000)+
        (+self.warriors()*1000)+
        (+self.attacks()*20);
      return stExp+runesExp;
    });
  self.missingExp = ko.computed(function(){
    var calculatedExp = +self.calculatedExp();
    var tlev = self.targetHeroLevel();
    var targetExp = getExpForLevel(+tlev);
    return +targetExp - (+calculatedExp);
    
  });
    self.expNeeded=ko.computed(function(){
      var tlev = self.targetHeroLevel();
      var targetExp = getExpForLevel(+tlev);
      var currentExp = self.currentExp();
      return +targetExp - (+currentExp);
    });
 
 self.calculateTrainings = function()
 {
   var expNeeded = self.expNeeded();   
   var excess = 0;
   
   var gandalfsNeeded = parseInt(expNeeded / 50000, 10);
   excess = expNeeded - (gandalfsNeeded * 50000);
   console.log(excess);
   
   var archersNeeded = parseInt(excess / 10000, 10);
   excess = expNeeded - (gandalfsNeeded * 50000) - (archersNeeded * 10000);
   console.log(excess);
   
   var warriorsNeeded = parseInt(excess / 1000, 10);
   excess = expNeeded - (gandalfsNeeded * 50000) - (archersNeeded * 10000) - (warriorsNeeded*1000);
   console.log(excess);
   
   var attacksNeeded = parseInt(excess/20, 10);
   console.log(excess);
   
   self.gandalfs(gandalfsNeeded);
   self.archers(archersNeeded);
   self.warriors(warriorsNeeded);
   self.attacks(attacksNeeded);
 };
  self.resetValues = function()
  {
    self.heroLevel(100);
    self.heroExp(0);
  self.targetHeroLevel(212);
  self.gandalfs(0);
  self.archers(0);
  self.warriors(0);
  self.attacks(0);
  };
 
 function getExpForLevel(level)
 {
   var lev = (+level)-1;
   var totalExp = 10*(lev+(lev*lev));   
   return totalExp;
 }
  
};


ko.applyBindings(new HeroCalcualtor(), document.getElementById("heroCalc"));
</script>
  </body>
</html>
